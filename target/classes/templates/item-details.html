<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/head :: page-head(title=${item.name})}"></head>

<body>
<div th:replace="~{fragments/header :: page-header}"></div>

<main class="section">
    <div class="container">
        <div th:if="${error}" class="alert alert-danger">
            <p th:text="${error}" style="margin: 0;"></p>
        </div>

        <div class="item-details-grid">
            <div class="item-image-container">
                <img th:src="${#lists.isEmpty(item.photoUrls) ? '/images/default.jpg' : item.photoUrls.get(0)}" alt="Item image" />
            </div>
            <div class="item-info-container">
                <h2 th:text="${item.name}">Item Name</h2>
                <p th:text="${item.description}">Item description.</p>
                <p><strong>Price:</strong> $<span th:text="${#numbers.formatDecimal(item.price, 1, 2)}">0.00</span></p>

                <div class="star-rating">
                    <span th:text="${#numbers.formatDecimal(item.getAverageRating(), 1, 1)}">0.0</span>/5
                    <a th:href="@{/item/{id}/reviews(id=${item.id})}" style="margin-left: 10px; text-decoration: underline;">
                        (<span th:text="${#lists.size(item.reviews)}">0</span> reviews)
                    </a>
                </div>
                <div sec:authorize="hasRole('ROLE_CUSTOMER')" style="margin-top: 20px;">
                    <form method="post" style="display: flex; align-items: center; gap: 15px;">
                        <input type="hidden" name="itemId" th:value="${item.id}" />

                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                        <label for="quantity">Quantity:</label>
                        <input type="number" id="quantity" name="quantity" value="1" min="1" style="width: 60px; padding: 5px;">

                        <button type="submit" th:formaction="@{/orders/now}" class="btn-login">Order Now</button>

                        <button type="submit" th:formaction="@{/cart/add}" class="btn-login" style="background-color: #5a6268; color: white;">Add to Cart</button>
                    </form>
                </div>
                </div>
            </div>
        </div>

        <div class="reviews-section">
        </div>
    </div>
</main>

<div th:replace="~{fragments/footer :: page-footer}"></div>
</body>
</html>