<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/head :: page-head(title=${item.name})}"></head>
<body>
<div th:replace="~{fragments/header :: page-header}"></div>

<main class="section">
    <div class="container">
        <div th:if="${success}" class="alert" style="background-color: #d4edda; color: #155724;" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <div class="item-details-grid">
            <div class="item-image-container">
                <img th:src="${#lists.isEmpty(item.photoUrls) ? '/images/default.jpg' : item.photoUrls.get(0)}" alt="Item image" />
            </div>
            <div class="item-info-container">
                <h2 th:text="${item.name}">Item Name</h2>
                <p th:text="${item.description}">Item description.</p>
                <p><strong>Price per Person:</strong> $<span th:text="${#numbers.formatDecimal(item.price, 1, 2)}">0.00</span></p>
                <p th:if="${item.basePrice != null}"><strong>Base Price (for >50 Guests):</strong> $<span th:text="${#numbers.formatDecimal(item.basePrice, 1, 2)}">0.00</span></p>

                <div sec:authorize="hasRole('ROLE_CUSTOMER')" class="form-box" style="margin-top: 30px; text-align: left;">
                    <h4>Request a Booking</h4>
                    <form id="bookingForm" th:action="@{/events/book/request}" method="post">
                        <input type="hidden" name="packageId" th:value="${item.id}" />

                        <div class="form-grid">
                            <div>
                                <label for="eventDate">Select a Date</label>
                                <input type="date" id="eventDate" name="eventDate" required>
                            </div>
                            <div>
                                <label for="eventTime">Select a Time</label>
                                <input type="time" id="eventTime" name="eventTime" required>
                            </div>
                            <div class="grid-full-width">
                                <label for="numberOfGuests">Number of Guests</label>
                                <input type="number" id="numberOfGuests" name="numberOfGuests" min="1" placeholder="e.g., 50" required>
                            </div>
                            <div class="grid-full-width">
                                <label for="specialRequests">Special Requests (Optional)</label>
                                <textarea id="specialRequests" name="specialRequests" rows="3" placeholder="e.g., Dietary needs, decorations, etc."></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn-login" style="width: 100%; margin-top: 20px;">Send Booking Request</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<div th:replace="~{fragments/footer :: page-footer}"></div>

<script th:inline="javascript">
    const unavailableDates = /*[[${unavailableDates}]]*/ [];
    const dateInput = document.getElementById('eventDate');
    dateInput.min = new Date().toISOString().split("T")[0];

    document.getElementById('bookingForm').addEventListener('submit', function(event) {
        const selectedDate = dateInput.value;
        if (unavailableDates.includes(selectedDate)) {
            alert('This date is already booked. Please choose a different date.');
            event.preventDefault();
        }
    });
</script>

</body>
</html>