<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: page-head(title='Book an Event')}"></head>
<body>
<div th:replace="~{fragments/header :: page-header}"></div>

<main class="section">
    <div class="container" style="max-width: 800px; text-align: left;">
        <h2>Book an Event</h2>
        <p>Select one of our premier packages and choose a date for your special occasion.</p>

        <div th:if="${success}" class="alert" style="background-color: #d4edda; color: #155724;" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <form id="bookingForm" th:action="@{/events/book/request}" method="post" class="form-box">
            <div class="form-grid">
                <div class="grid-full-width">
                    <label for="packageId">Choose Your Event Package</label>
                    <select id="packageId" name="packageId" required>
                        <option value="">-- Please select a package --</option>
                        <option th:each="pkg : ${eventPackages}" th:value="${pkg.id}" th:text="${pkg.name + ' - $' + #numbers.formatDecimal(pkg.price, 1, 2)}"></option>
                    </select>
                </div>

                <div>
                    <label for="eventDate">Event Date</label>
                    <input type="date" id="eventDate" name="eventDate" required>
                </div>
                <div>
                    <label for="eventTime">Event Time</label>
                    <input type="time" id="eventTime" name="eventTime" required>
                </div>

                <div class="grid-full-width">
                    <label for="numberOfGuests">Number of Guests</label>
                    <input type="number" id="numberOfGuests" name="numberOfGuests" min="1" placeholder="e.g., 50" required>
                </div>

                <div class="grid-full-width">
                    <label for="specialRequests">Special Requests (Optional)</label>
                    <textarea id="specialRequests" name="specialRequests" rows="4" placeholder="e.g., Special dietary needs, decorations, etc."></textarea>
                </div>
            </div>

            <button type="submit" class="btn-login" style="width: 100%; margin-top: 30px;">Send Booking Request</button>
        </form>
    </div>
</main>

<div th:replace="~{fragments/footer :: page-footer}"></div>

<script th:inline="javascript">
    /* A simple array of unavailable dates passed from the backend */
    const unavailableDates = /*[[${unavailableDates}]]*/ [];

    const dateInput = document.getElementById('eventDate');

    // Set the minimum selectable date to today
    dateInput.min = new Date().toISOString().split("T")[0];

    // Add an event listener to the form to validate the date before submitting
    document.getElementById('bookingForm').addEventListener('submit', function(event) {
        const selectedDate = dateInput.value;
        if (unavailableDates.includes(selectedDate)) {
            alert('The selected date is not available. Please choose a different date.');
            event.preventDefault();
        }
    });
</script>

</body>
</html>